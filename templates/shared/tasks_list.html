{% extends "shared/base.html" %}

{% block title %}–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è ‚Äî Adaptive Math{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
        <h1 class="h3 fw-bold my-2">üìö –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è</h1>
        <div class="d-flex gap-2 my-2">
            <a href="{{ url_for('main.dashboard') }}" class="btn btn-outline-secondary">‚Üê –ù–∞–∑–∞–¥ –≤ –ø–∞–Ω–µ–ª—å</a>
            {% if current_user.role == 'teacher' %}
                <a href="{{ url_for('tasks.create_task') }}" class="btn btn-success">‚ûï –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ</a>
            {% endif %}
        </div>
    </div>

    {% if tasks %}
        <div class="row g-3">
            {% for task in tasks %}
                <div class="col-12">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <h3 class="h5 mb-2">{{ task.title }}</h3>
                                <span class="badge
                                    {% if task.level == 'low' %} bg-success
                                    {% elif task.level == 'medium' %} bg-warning text-dark
                                    {% elif task.level == 'high' %} bg-danger
                                    {% else %} bg-secondary
                                    {% endif %}">
                                    {% if task.level == 'low' %}üü¢ –ù–∏–∑–∫–∏–π
                                    {% elif task.level == 'medium' %}üü° –°—Ä–µ–¥–Ω–∏–π
                                    {% elif task.level == 'high' %}üî¥ –í—ã—Å–æ–∫–∏–π
                                    {% else %}{{ task.level }}
                                    {% endif %}
                                </span>
                            </div>

                            <div class="text-muted mb-2">
                                <span class="me-3"><strong>–¢–µ–º–∞:</strong> {{ task.topic_ref.name if task.topic_ref else '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ç–µ–º–∞' }}</span>
                                <span><strong>–ú–∞–∫—Å. –±–∞–ª–ª:</strong> {{ task.max_score }}</span>
                            </div>

                            {% if current_user.role == 'student' and task.id in user_attempts %}
                                <div class="mb-2">
                                    <span class="badge bg-success">–í–∞—à–∏ –ø–æ–ø—ã—Ç–∫–∏: {{ user_attempts[task.id]|length }}</span>
                                </div>
                            {% endif %}

                            <div class="text-end">
                                <a href="{{ url_for('tasks.view_task', task_id=task.id) }}" class="btn btn-primary">
                                    {% if current_user.role == "student" %}üìù –†–µ—à–∞—Ç—å{% else %}üëÅÔ∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å{% endif %}
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center text-muted py-5">
            <p class="mb-0">–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π.</p>
        </div>
    {% endif %}
</div>
{% endblock %}
