<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{{ task.title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <h1>üìù {{ task.title }}</h1>
        
        <div style="text-align: center; margin-bottom: 30px;">
            <a href="{{ url_for('tasks.list_tasks') }}" class="btn">‚Üê –ù–∞–∑–∞–¥ –∫ –∑–∞–¥–∞–Ω–∏—è–º</a>
        </div>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
            <h3 style="color: #495057; margin-top: 0;">üìã –£—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞—á–∏:</h3>
            <p style="white-space: pre-wrap; line-height: 1.6;">{{ task.description }}</p>
        </div>
        
        <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin: 20px 0;">
            <p><strong>üìö –¢–µ–º–∞:</strong> {{ task.topic_ref.name if task.topic_ref else '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ç–µ–º–∞' }}</p>
            <p><strong>‚≠ê –°–ª–æ–∂–Ω–æ—Å—Ç—å:</strong> 
                {% if task.level == 'low' %}üü¢ –ù–∏–∑–∫–∏–π
                {% elif task.level == 'medium' %}üü° –°—Ä–µ–¥–Ω–∏–π
                {% elif task.level == 'high' %}üî¥ –í—ã—Å–æ–∫–∏–π
                {% else %}{{ task.level }}
                {% endif %}
            </p>
            <p><strong>üéØ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª:</strong> {{ task.max_score }}</p>
            <p><strong>üìÖ –°–æ–∑–¥–∞–Ω–æ:</strong> {{ task.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
        </div>
        
        {% if current_user.role == 'student' %}
            <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin: 20px 0;">
                <h3 style="color: #856404; margin-top: 0;">üìà –í–∞—à–∏ –ø–æ–ø—ã—Ç–∫–∏: {{ user_attempts|length }}</h3>
                {% if user_attempts %}
                    {% for attempt in user_attempts[:3] %}
                        <p><strong>–ü–æ–ø—ã—Ç–∫–∞ {{ loop.index }}:</strong> –ë–∞–ª–ª {{ attempt.partial_score }}/{{ task.max_score }} ({{ attempt.created_at.strftime("%d.%m.%Y %H:%M") }})</p>
                    {% endfor %}
                {% else %}
                    <p>–ü–æ–ø—ã—Ç–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç</p>
                {% endif %}
            </div>
            
            <form method="POST" action="{{ url_for('tasks.solve_task', task_id=task.id) }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <div style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0; border: 2px solid #3498db;">
                    <h3 style="color: #2c3e50; margin-top: 0;">‚úèÔ∏è –í–∞—à –æ—Ç–≤–µ—Ç:</h3>
                    
                    <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ —Å —Ç–∏–ø–æ–º –æ—Ç–≤–µ—Ç–∞ -->
                    <input type="hidden" name="answer_type" value="{{ task.correct_answer.type if task.correct_answer else 'number' }}">
                    
                    <!-- –ß–∏—Å–ª–æ–≤–æ–π –æ—Ç–≤–µ—Ç -->
                    <div class="answer-group" id="number-answer-group">
                        <div class="form-group">
                            <label for="number_answer">–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ:</label>
                            <input type="number" id="number_answer" name="number_answer" step="any" 
                                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 42 –∏–ª–∏ 3.14" 
                                   class="student-input">
                            <small class="form-help">–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</small>
                        </div>
                    </div>
                    
                    <!-- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ -->
                    <div class="answer-group" id="variables-answer-group">
                        <label>–ó–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:</label>
                        <div id="student-variables-container">
                            {% if task.correct_answer and task.correct_answer.type == 'variables' and task.correct_answer.variables %}
                                {% for var in task.correct_answer.variables %}
                                <div class="variable-pair">
                                    <span class="var-name">{{ var.name }} =</span>
                                    <input type="number" name="var_value_{{ var.name }}" step="any" 
                                           placeholder="–ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è {{ var.name }}" 
                                           class="var-input">
                                </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                        <small class="form-help">–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π</small>
                    </div>
                    
                    <!-- –ò–Ω—Ç–µ—Ä–≤–∞–ª -->
                    <div class="answer-group" id="interval-answer-group">
                        <label>–ß–∏—Å–ª–æ–≤–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª:</label>
                        <div class="interval-container">
                            <div class="interval-bound">
                                <input type="number" id="interval_start" name="interval_start" step="any" 
                                       placeholder="–ù–∞—á–∞–ª–æ" class="interval-input">
                                <label class="checkbox-small">
                                    <input type="checkbox" id="start_inclusive" name="start_inclusive" checked>
                                    –í–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ
                                </label>
                            </div>
                            <span class="interval-separator">‚Äî</span>
                            <div class="interval-bound">
                                <input type="number" id="interval_end" name="interval_end" step="any" 
                                       placeholder="–ö–æ–Ω–µ—Ü" class="interval-input">
                                <label class="checkbox-small">
                                    <input type="checkbox" id="end_inclusive" name="end_inclusive">
                                    –í–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ
                                </label>
                            </div>
                        </div>
                        <small class="form-help">–ü—Ä–∏–º–µ—Ä: [2, 8) - –æ—Ç 2 –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–æ 8 –Ω–µ–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ</small>
                    </div>
                    
                    <!-- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å -->
                    <div class="answer-group" id="sequence-answer-group">
                        <div class="form-group">
                            <label for="sequence_values">–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —á–∏—Å–µ–ª:</label>
                            <input type="text" id="sequence_values" name="sequence_values" 
                                   placeholder="1, 2, 5, 8, 13" 
                                   class="student-input">
                            <small class="form-help">–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é. –ü—Ä–∏–º–µ—Ä: 1, 2, 5, 8, 13</small>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button type="submit" class="btn btn-success">üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ</button>
                    </div>
                </div>
            </form>
        {% endif %}
    </div>
    
    <script>
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≥—Ä—É–ø–ø—É –æ—Ç–≤–µ—Ç–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏
        document.addEventListener('DOMContentLoaded', function() {
            const answerType = document.querySelector('input[name="answer_type"]').value;
            showAnswerGroup(answerType);
        });
        
        function showAnswerGroup(answerType) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≥—Ä—É–ø–ø—ã –æ—Ç–≤–µ—Ç–æ–≤
            document.querySelectorAll('.answer-group').forEach(group => {
                group.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é –≥—Ä—É–ø–ø—É
            const targetGroup = document.getElementById(answerType + '-answer-group');
            if (targetGroup) {
                targetGroup.classList.add('active');
            }
        }
    </script>
</body>
</html>
