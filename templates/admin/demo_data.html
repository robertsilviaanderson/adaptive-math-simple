{% extends "admin/base_admin.html" %}

{% block title %}–î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ - –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞{% endblock %}

{% block admin_content %}
<h2>üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–º–∏</h2>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-number">{{ stats.total_users }}</div>
        <div>–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ stats.students }}</div>
        <div>–°—Ç—É–¥–µ–Ω—Ç–æ–≤</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ stats.teachers }}</div>
        <div>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ stats.admins }}</div>
        <div>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ stats.total_tasks }}</div>
        <div>–í—Å–µ–≥–æ –∑–∞–¥–∞–Ω–∏–π</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ stats.total_attempts }}</div>
        <div>–ü–æ–ø—ã—Ç–æ–∫ —Ä–µ—à–µ–Ω–∏—è</div>
    </div>
</div>

<h3>üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è–º–∏</h3>

<div class="action-buttons">
    <button class="action-btn" onclick="window.taskManager ? window.taskManager.openImportModal() : openImportModal()">
        üìÇ –ò–º–ø–æ—Ä—Ç –∑–∞–¥–∞–Ω–∏–π
    </button>
    <button class="action-btn" onclick="window.taskManager ? window.taskManager.exportTasks() : exportTasks()">
        üíæ –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–¥–∞–Ω–∏–π
    </button>
</div>

<h3>üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>

<div class="action-buttons">
    <a href="{{ url_for('admin.create_demo_users') }}" class="action-btn">
        üë• –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    </a>
</div>

<h3>üóëÔ∏è –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h3>

<div class="action-buttons">
    <button class="action-btn danger" onclick="clearDatabase()">
        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
    </button>
</div>

<div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin: 20px 0;">
    <h4 style="color: #856404; margin-top: 0;">‚ö†Ô∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
    <p style="color: #856404; margin-bottom: 0;">
        –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: student/123456, teacher/123456, CalmAndManage/KeepMathAlive
    </p>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∑–∞–¥–∞–Ω–∏–π -->
<div id="importModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>üìÇ –ò–º–ø–æ—Ä—Ç –∑–∞–¥–∞–Ω–∏–π</h3>
            <span class="close" onclick="closeImportModal()">&times;</span>
        </div>
        <div class="modal-body">
            <p>–í—ã–±–µ—Ä–∏—Ç–µ JSON —Ñ–∞–π–ª —Å –∑–∞–¥–∞–Ω–∏—è–º–∏ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞:</p>
            <div class="info-box">
                <h4>üìã –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞</h4>
                <p>–§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å JSON –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª–µ–º "tasks" - –º–∞—Å—Å–∏–≤–æ–º –∑–∞–¥–∞–Ω–∏–π.</p>
                <p><strong>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã –æ—Ç–≤–µ—Ç–æ–≤:</strong></p>
                <ul>
                    <li><code>number</code> - —á–∏—Å–ª–æ–≤–æ–π –æ—Ç–≤–µ—Ç</li>
                    <li><code>variables</code> - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏</li>
                    <li><code>interval</code> - —á–∏—Å–ª–æ–≤—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã</li>
                    <li><code>sequence</code> - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —á–∏—Å–µ–ª</li>
                </ul>
                <p><a href="{{ url_for('static', filename='sample_tasks_import.json') }}" download>üì• –°–∫–∞—á–∞—Ç—å –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞</a></p>
            </div>
            <form id="importForm" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <div class="form-group">
                    <input type="file" id="importFile" name="import_file" accept=".json" required>
                    <small class="form-text text-muted">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON</small>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">üìÇ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button type="button" class="btn" onclick="closeImportModal()">‚ùå –û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
            <div id="importResult" style="margin-top: 20px; display: none;"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/task-management.js') }}"></script>
{% endblock %}
