{% extends "admin/base_admin.html" %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã{% endblock %}

{% block content %}
<div class="admin-content">
    <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
    
    <div class="settings-section">
        <h3>üéØ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º</h3>
        <p class="section-description">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –æ–±—É—á–µ–Ω–∏—è</p>
        
        <div class="settings-grid">
            <div class="setting-item">
                <label for="difficulty_weight">–í–µ—Å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–¥–∞—á</label>
                <input type="range" id="difficulty_weight" min="0.1" max="2.0" step="0.1" value="1.0">
                <span class="setting-value">1.0</span>
            </div>
            
            <div class="setting-item">
                <label for="time_weight">–í–µ—Å –≤—Ä–µ–º–µ–Ω–∏ —Ä–µ—à–µ–Ω–∏—è</label>
                <input type="range" id="time_weight" min="0.1" max="2.0" step="0.1" value="0.8">
                <span class="setting-value">0.8</span>
            </div>
            
            <div class="setting-item">
                <label for="accuracy_weight">–í–µ—Å —Ç–æ—á–Ω–æ—Å—Ç–∏ –æ—Ç–≤–µ—Ç–æ–≤</label>
                <input type="range" id="accuracy_weight" min="0.1" max="2.0" step="0.1" value="1.2">
                <span class="setting-value">1.2</span>
            </div>
            
            <div class="setting-item">
                <label for="progress_threshold">–ü–æ—Ä–æ–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</label>
                <input type="range" id="progress_threshold" min="0.5" max="0.95" step="0.05" value="0.75">
                <span class="setting-value">0.75</span>
            </div>
        </div>
    </div>

    <div class="settings-section">
        <h3>üìä –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è</h3>
        <p class="section-description">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è –∏ –±–∞–ª–ª–æ–≤</p>
        
        <div class="settings-grid">
            <div class="setting-item">
                <label for="max_attempts">–ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ –∑–∞–¥–∞—á—É</label>
                <input type="number" id="max_attempts" min="1" max="10" value="3">
            </div>
            
            <div class="setting-item">
                <label for="partial_credit">–ß–∞—Å—Ç–∏—á–Ω—ã–µ –±–∞–ª–ª—ã</label>
                <input type="checkbox" id="partial_credit" checked>
                <span class="checkbox-label">–†–∞–∑—Ä–µ—à–∏—Ç—å —á–∞—Å—Ç–∏—á–Ω—ã–µ –±–∞–ª–ª—ã</span>
            </div>
            
            <div class="setting-item">
                <label for="hint_penalty">–®—Ç—Ä–∞—Ñ –∑–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∏ (%)</label>
                <input type="range" id="hint_penalty" min="0" max="50" step="5" value="10">
                <span class="setting-value">10%</span>
            </div>
        </div>
    </div>

    <div class="settings-section">
        <h3>üé® –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å</h3>
        <p class="section-description">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ –∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</p>
        
        <div class="settings-grid">
            <div class="setting-item">
                <label for="theme">–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</label>
                <select id="theme">
                    <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
                    <option value="dark">–¢–µ–º–Ω–∞—è</option>
                    <option value="auto">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è</option>
                </select>
            </div>
            
            <div class="setting-item">
                <label for="language">–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</label>
                <select id="language">
                    <option value="ru" selected>–†—É—Å—Å–∫–∏–π</option>
                    <option value="en">English</option>
                </select>
            </div>
            
            <div class="setting-item">
                <label for="notifications">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</label>
                <input type="checkbox" id="notifications" checked>
                <span class="checkbox-label">–í–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
            </div>
        </div>
    </div>

    <div class="settings-section">
        <h3>üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
        <p class="section-description">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –¥–æ—Å—Ç—É–ø–∞</p>
        
        <div class="settings-grid">
            <div class="setting-item">
                <label for="session_timeout">–í—Ä–µ–º—è —Å–µ—Å—Å–∏–∏ (–º–∏–Ω—É—Ç—ã)</label>
                <input type="number" id="session_timeout" min="15" max="480" value="120">
            </div>
            
            <div class="setting-item">
                <label for="password_strength">–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—é</label>
                <select id="password_strength">
                    <option value="weak">–°–ª–∞–±—ã–µ</option>
                    <option value="medium" selected>–°—Ä–µ–¥–Ω–∏–µ</option>
                    <option value="strong">–°—Ç—Ä–æ–≥–∏–µ</option>
                </select>
            </div>
            
            <div class="setting-item">
                <label for="auto_logout">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã—Ö–æ–¥</label>
                <input type="checkbox" id="auto_logout" checked>
                <span class="checkbox-label">–ü—Ä–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</span>
            </div>
        </div>
    </div>

    <div class="action-buttons">
        <button type="button" class="btn btn-primary" onclick="saveSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        <button type="button" class="btn btn-secondary" onclick="resetSettings()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –∫ —É–º–æ–ª—á–∞–Ω–∏—é</button>
        <button type="button" class="btn btn-warning" onclick="exportSettings()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫</button>
        <button type="button" class="btn btn-info" onclick="importSettings()">üì• –ò–º–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫</button>
    </div>

    <div class="settings-info">
        <div class="info-card">
            <h4>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
            <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º–µ –∏ –≤–ª–∏—è—é—Ç –Ω–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</p>
            <p>–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å—Ç—É–ø–∞—é—Ç –≤ —Å–∏–ª—É –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.</p>
            <p>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–µ—Ä–µ–¥ –≤–Ω–µ—Å–µ–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π.</p>
        </div>
    </div>
</div>

<style>
.settings-section {
    background: white;
    border-radius: 10px;
    padding: 25px;
    margin-bottom: 25px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.settings-section h3 {
    margin: 0 0 10px 0;
    color: #333;
    font-size: 1.3em;
}

.section-description {
    color: #666;
    margin-bottom: 20px;
    font-style: italic;
}

.settings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.setting-item {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.setting-item label {
    font-weight: 600;
    color: #333;
    font-size: 0.9em;
}

.setting-item input[type="range"],
.setting-item input[type="number"],
.setting-item select {
    padding: 8px 12px;
    border: 2px solid #e9ecef;
    border-radius: 6px;
    font-size: 0.9em;
    transition: border-color 0.3s ease;
}

.setting-item input[type="range"]:focus,
.setting-item input[type="number"]:focus,
.setting-item select:focus {
    outline: none;
    border-color: #007bff;
}

.setting-item input[type="checkbox"] {
    width: 20px;
    height: 20px;
    margin-right: 10px;
}

.checkbox-label {
    display: flex;
    align-items: center;
    font-size: 0.9em;
    color: #555;
}

.setting-value {
    font-weight: bold;
    color: #007bff;
    font-size: 0.9em;
}

.action-buttons {
    display: flex;
    gap: 15px;
    margin: 30px 0;
    flex-wrap: wrap;
}

.settings-info {
    margin-top: 30px;
}

.info-card {
    background: #f8f9fa;
    border-left: 4px solid #007bff;
    padding: 20px;
    border-radius: 6px;
}

.info-card h4 {
    margin: 0 0 15px 0;
    color: #333;
}

.info-card p {
    margin: 8px 0;
    color: #666;
    line-height: 1.5;
}

@media (max-width: 768px) {
    .settings-grid {
        grid-template-columns: 1fr;
    }
    
    .action-buttons {
        flex-direction: column;
    }
}
</style>

<script>
function saveSettings() {
    // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    const settings = {
        difficulty_weight: document.getElementById('difficulty_weight').value,
        time_weight: document.getElementById('time_weight').value,
        accuracy_weight: document.getElementById('accuracy_weight').value,
        progress_threshold: document.getElementById('progress_threshold').value,
        max_attempts: document.getElementById('max_attempts').value,
        partial_credit: document.getElementById('partial_credit').checked,
        hint_penalty: document.getElementById('hint_penalty').value,
        theme: document.getElementById('theme').value,
        language: document.getElementById('language').value,
        notifications: document.getElementById('notifications').checked,
        session_timeout: document.getElementById('session_timeout').value,
        password_strength: document.getElementById('password_strength').value,
        auto_logout: document.getElementById('auto_logout').checked
    };
    
    // –ó–¥–µ—Å—å –±—É–¥–µ—Ç AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
    alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! (–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)');
    console.log('Settings to save:', settings);
}

function resetSettings() {
    if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')) {
        // –°–±—Ä–æ—Å –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        document.getElementById('difficulty_weight').value = 1.0;
        document.getElementById('time_weight').value = 0.8;
        document.getElementById('accuracy_weight').value = 1.2;
        document.getElementById('progress_threshold').value = 0.75;
        document.getElementById('max_attempts').value = 3;
        document.getElementById('partial_credit').checked = true;
        document.getElementById('hint_penalty').value = 10;
        document.getElementById('theme').value = 'light';
        document.getElementById('language').value = 'ru';
        document.getElementById('notifications').checked = true;
        document.getElementById('session_timeout').value = 120;
        document.getElementById('password_strength').value = 'medium';
        document.getElementById('auto_logout').checked = true;
        
        updateAllValues();
        alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
    }
}

function exportSettings() {
    const settings = {
        difficulty_weight: document.getElementById('difficulty_weight').value,
        time_weight: document.getElementById('time_weight').value,
        accuracy_weight: document.getElementById('accuracy_weight').value,
        progress_threshold: document.getElementById('progress_threshold').value,
        max_attempts: document.getElementById('max_attempts').value,
        partial_credit: document.getElementById('partial_credit').checked,
        hint_penalty: document.getElementById('hint_penalty').value,
        theme: document.getElementById('theme').value,
        language: document.getElementById('language').value,
        notifications: document.getElementById('notifications').checked,
        session_timeout: document.getElementById('session_timeout').value,
        password_strength: document.getElementById('password_strength').value,
        auto_logout: document.getElementById('auto_logout').checked
    };
    
    const dataStr = JSON.stringify(settings, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'math_system_settings.json';
    link.click();
}

function importSettings() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const settings = JSON.parse(e.target.result);
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    Object.keys(settings).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) {
                            if (element.type === 'checkbox') {
                                element.checked = settings[key];
                            } else {
                                element.value = settings[key];
                            }
                        }
                    });
                    updateAllValues();
                    alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã');
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫: ' + error.message);
                }
            };
            reader.readAsText(file);
        }
    };
    input.click();
}

function updateAllValues() {
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è range inputs
    const ranges = document.querySelectorAll('input[type="range"]');
    ranges.forEach(range => {
        const valueSpan = range.nextElementSibling;
        if (valueSpan && valueSpan.classList.contains('setting-value')) {
            let value = range.value;
            if (range.id === 'hint_penalty') {
                value += '%';
            }
            valueSpan.textContent = value;
        }
    });
}

// –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
document.addEventListener('DOMContentLoaded', function() {
    const ranges = document.querySelectorAll('input[type="range"]');
    ranges.forEach(range => {
        range.addEventListener('input', function() {
            const valueSpan = this.nextElementSibling;
            if (valueSpan && valueSpan.classList.contains('setting-value')) {
                let value = this.value;
                if (this.id === 'hint_penalty') {
                    value += '%';
                }
                valueSpan.textContent = value;
            }
        });
    });
    
    updateAllValues();
});
</script>
{% endblock %}
