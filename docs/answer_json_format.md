# Архитектура JSON-ответов в системе адаптивного обучения математике

## Обзор

Все правильные ответы в системе хранятся в поле `correct_answer` как JSON-структуры. Поле `type` определяет формат данных и логику проверки ответа.

## Поддерживаемые типы ответов

### 1. `"number"` - Единственное числовое значение

**Структура:**
```json
{
  "type": "number",
  "value": 75.5
}
```

**Примеры использования:**
- Площадь треугольника = 24
- Корень уравнения x² = 16 → x = 4
- Результат вычисления = -16
- Значение функции f(3) = 27

**Примеры JSON:**
```json
{"type": "number", "value": 42}
{"type": "number", "value": -3.14}
{"type": "number", "value": 0}
```

---

### 2. `"variables"` - Именованные переменные

**Структура:**
```json
{
  "type": "variables",
  "variables": [
    {"name": "x", "value": 3},
    {"name": "y", "value": -2}
  ]
}
```

**Примеры использования:**
- Система уравнений: x = 3, y = 2
- Координаты точки: x = 5, y = -7
- Корни квадратного уравнения: x₁ = 2, x₂ = 3
- Параметры функции: a = 1, b = -5, c = 6

**Примеры JSON:**
```json
{
  "type": "variables",
  "variables": [
    {"name": "x", "value": 3},
    {"name": "y", "value": 2}
  ]
}
```

```json
{
  "type": "variables",
  "variables": [
    {"name": "x1", "value": 2},
    {"name": "x2", "value": 3}
  ]
}
```

---

### 3. `"interval"` - Числовой интервал

**Структура:**
```json
{
  "type": "interval",
  "start": 2,
  "end": 8,
  "start_inclusive": true,
  "end_inclusive": false
}
```

**Поля:**
- `start` - начало интервала (number или null для -∞)
- `end` - конец интервала (number или null для +∞)
- `start_inclusive` - включается ли начальная точка (boolean)
- `end_inclusive` - включается ли конечная точка (boolean)

**Примеры использования:**
- Область определения функции: (-∞; 5]
- Решение неравенства: [3; 7)
- Промежуток возрастания: (0; +∞)
- Область значений: [-1; 1]

**Примеры JSON:**
```json
{"type": "interval", "start": 2, "end": 8, "start_inclusive": true, "end_inclusive": false}
```
Означает: [2; 8)

```json
{"type": "interval", "start": null, "end": 5, "start_inclusive": false, "end_inclusive": true}
```
Означает: (-∞; 5]

```json
{"type": "interval", "start": 0, "end": null, "start_inclusive": false, "end_inclusive": false}
```
Означает: (0; +∞)

---

### 4. `"sequence"` - Последовательность чисел

**Структура:**
```json
{
  "type": "sequence",
  "values": [1, 2, 5, 8, 13]
}
```

**Примеры использования:**
- Корни многочлена: [1, 3, -2, 5]
- Последовательность Фибоначчи: [1, 1, 2, 3, 5, 8]
- Множество решений: [0, 2, 4, 6]
- Координаты точек на прямой: [-3, 0, 2, 7]
- Значения функции в точках: [1, 4, 9, 16, 25]

**Примеры JSON:**
```json
{"type": "sequence", "values": [1, 1, 2, 3, 5, 8]}
```

```json
{"type": "sequence", "values": [-2, 0, 3, 7]}
```

```json
{"type": "sequence", "values": [0.5, 1.5, 2.5, 3.5]}
```

---

## Логика проверки ответов

### Для типа `"number"`
- Преобразование пользовательского ввода в число
- Сравнение с допустимой погрешностью (например, ±0.001)

### Для типа `"variables"`
- Парсинг пользовательского ввода в формате "x=3, y=2" или "x=3; y=2"
- Проверка соответствия всех переменных и их значений

### Для типа `"interval"`
- Парсинг математической нотации: [2; 8), (-∞; 5], (0; +∞)
- Проверка границ и их включенности

### Для типа `"sequence"`
- Парсинг списка чисел: "1, 2, 5, 8, 13" или "1; 2; 5; 8; 13"
- Проверка порядка элементов (важен ли порядок зависит от задачи)

---

## Миграция существующих данных

Старые форматы должны быть преобразованы:

**Старый формат:**
```json
{"answer": "75"}
```

**Новый формат:**
```json
{"type": "number", "value": 75}
```

---

## Примеры задач

### Задача 1: Простое вычисление
**Условие:** Найдите значение выражения: 15 × (27 + 48) ÷ 9 - 50
**Ответ:**
```json
{"type": "number", "value": 75}
```

### Задача 2: Система уравнений
**Условие:** Решите систему: 2x + 3y = 12, 3x - y = 7
**Ответ:**
```json
{
  "type": "variables",
  "variables": [
    {"name": "x", "value": 3},
    {"name": "y", "value": 2}
  ]
}
```

### Задача 3: Неравенство
**Условие:** Решите неравенство: 2 ≤ x < 8
**Ответ:**
```json
{
  "type": "interval",
  "start": 2,
  "end": 8,
  "start_inclusive": true,
  "end_inclusive": false
}
```

### Задача 4: Корни уравнения
**Условие:** Найдите все корни уравнения: x³ - 6x² + 11x - 6 = 0
**Ответ:**
```json
{"type": "sequence", "values": [1, 2, 3]}
```

---

## Расширяемость

В будущем можно добавить дополнительные типы:
- `"matrix"` - для матриц
- `"complex"` - для комплексных чисел
- `"function"` - для функциональных ответов
- `"intervals"` - для объединения интервалов

---

*Документ создан: 2025-08-08*
*Версия: 1.0*
