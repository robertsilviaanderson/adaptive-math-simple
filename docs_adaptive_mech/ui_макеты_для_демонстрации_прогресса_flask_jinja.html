<!-- =============================================================
UI MOCKUPS (Flask + Jinja)
Author: Astramoc demo
Notes: Each section is a separate Jinja template. Copy to your /templates folder.
Dependencies: Bootstrap 5 (or your existing admin CSS), Chart.js (only on analytics page).
============================================================= -->

<!-- =============================================================
1) dashboard_progress.html ‚Äî –ü–∞–Ω–µ–ª—å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ —Ç–µ–º–∞–º (–ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:
- –¶–µ–ª—å: –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å —É—á–µ–Ω–∏–∫–æ–≤ –ø–æ —Ç–µ–º–µ, –±—ã—Å—Ç—Ä–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å—á—ë—Ç –∏ –ø–µ—Ä–µ–π—Ç–∏ –≤ –∏—Å—Ç–æ—Ä–∏—é.
- –†–æ—É—Ç: GET /admin/progress
- –ö–æ–Ω—Ç–µ–∫—Å—Ç:
  topics: [{id, name}]
  rows: [
    {
      user: {id, first_name, last_name},
      topic: {id, name},
      current_level: 'low'|'medium'|'high'|'done',
      last_evaluated_at: datetime|None,
      trend: 'up'|'down'|'stay'|'mastered'|None,
      weekly_summary: {accuracy: float, time_score: float, progress_score: float, motivation_score: float, total_score: float}
    }
  ]
- –î–µ–π—Å—Ç–≤–∏—è:
  ‚Ä¢ –ö–Ω–æ–ø–∫–∞ "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é" ‚Üí POST /admin/progress/evaluate (–æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å toaster + refresh)
  ‚Ä¢ –ö–Ω–æ–ø–∫–∞ "–ò—Å—Ç–æ—Ä–∏—è" ‚Üí /admin/progress/history?user_id=&topic_id=
- –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏: —Å–µ—Ä–≤–µ—Ä –æ—Ç–¥–∞—ë—Ç —É–∂–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ; —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–ø–∏–Ω–Ω–µ—Ä.
============================================================= -->
{% extends "admin/base_admin.html" %}
{% block title %}–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ç–µ–º–∞–º{% endblock %}
{% block admin_content %}
<div class="admin-content">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>üìà –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ç–µ–º–∞–º</h2>
    <form action="{{ url_for('admin.evaluate_progress') }}" method="post" onsubmit="return confirm('–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å—á—ë—Ç –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π?');">
      <button class="btn btn-primary">üöÄ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é</button>
    </form>
  </div>

  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>–£—á–µ–Ω–∏–∫</th>
          <th>–¢–µ–º–∞</th>
          <th>–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å</th>
          <th>–ò—Ç–æ–≥ (total_score)</th>
          <th>–¢—Ä–µ–Ω–¥</th>
          <th>–û–±–Ω–æ–≤–ª–µ–Ω–æ</th>
          <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody>
        {% for row in rows %}
        <tr>
          <td>{{ row.user.last_name }} {{ row.user.first_name }}</td>
          <td>{{ row.topic.name }}</td>
          <td>
            <span class="badge level-{{ row.current_level }}">{{ row.current_level|capitalize }}</span>
          </td>
          <td>{{ '%.2f'|format(row.weekly_summary.total_score or 0) }}</td>
          <td>
            {% if row.trend == 'up' %}<span class="text-success">‚¨Ü</span>{% endif %}
            {% if row.trend == 'down' %}<span class="text-danger">‚¨á</span>{% endif %}
            {% if row.trend == 'stay' %}<span class="text-muted">‚Üí</span>{% endif %}
            {% if row.trend == 'mastered' %}<span class="text-success">üèÅ</span>{% endif %}
          </td>
          <td>{{ row.last_evaluated_at.strftime('%d.%m.%Y %H:%M') if row.last_evaluated_at else '‚Äî' }}</td>
          <td>
            <a class="btn btn-sm btn-outline-primary" href="{{ url_for('admin.progress_history', user_id=row.user.id, topic_id=row.topic.id) }}">–ò—Å—Ç–æ—Ä–∏—è</a>
            <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('admin.student_detail', user_id=row.user.id) }}">–ü—Ä–æ—Ñ–∏–ª—å</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<style>
.badge.level-low{background:#d1ecf1;color:#0c5460}
.badge.level-medium{background:#fff3cd;color:#856404}
.badge.level-high{background:#f8d7da;color:#721c24}
.badge.level-done{background:#d4edda;color:#155724}
</style>
{% endblock %}


<!-- =============================================================
2) history_timeline.html ‚Äî –ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—á—ë—Ç–æ–≤ (–ø–æ —É—á–µ–Ω–∏–∫—É –∏ —Ç–µ–º–µ)
–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:
- –†–æ—É—Ç: GET /admin/progress/history?user_id=&topic_id=
- –ö–æ–Ω—Ç–µ–∫—Å—Ç:
  user: {id, first_name, last_name}
  topic: {id, name}
  logs: [
    {period_start, period_end, level, accuracy, time_score, progress_score, motivation_score, total_score, level_change}
  ] –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –¥–∞—Ç–µ.
- UI: "–ª–µ–Ω—Ç–∞" —Ä–∞—Å—á—ë—Ç–æ–≤ —Å –ø–ª–∞—à–∫–∞–º–∏ (up/down/stay/mastered), —Ç–∞–±–ª–∏—Ü–∞ –º–µ—Ç—Ä–∏–∫, –∫–Ω–æ–ø–∫–∞ ¬´–ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Ä–∞—Å—á—ë—Ç¬ª.
============================================================= -->
{% extends "admin/base_admin.html" %}
{% block title %}–ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—á—ë—Ç–æ–≤{% endblock %}
{% block admin_content %}
<div class="admin-content">
  <h2>üïò –ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—á—ë—Ç–æ–≤ ‚Äî {{ user.last_name }} {{ user.first_name }} / ¬´{{ topic.name }}¬ª</h2>

  <div class="timeline">
    {% for log in logs %}
      <div class="timeline-item">
        <div class="timeline-date">{{ log.period_start }} ‚Äî {{ log.period_end }}</div>
        <div class="timeline-card">
          <div class="d-flex justify-content-between">
            <div>
              <div class="text-muted">–£—Ä–æ–≤–µ–Ω—å</div>
              <div class="fw-bold">{{ log.level|capitalize }}</div>
            </div>
            <div class="text-end">
              <div class="text-muted">–†–µ—à–µ–Ω–∏–µ</div>
              <div>
                {% if log.level_change=='up' %}<span class="badge bg-success">–ü–æ–≤—ã—à–µ–Ω–∏–µ</span>{% endif %}
                {% if log.level_change=='down' %}<span class="badge bg-danger">–ü–æ–Ω–∏–∂–µ–Ω–∏–µ</span>{% endif %}
                {% if log.level_change=='stay' %}<span class="badge bg-secondary">–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π</span>{% endif %}
                {% if log.level_change=='mastered' %}<span class="badge bg-primary">–¢–µ–º–∞ –æ—Å–≤–æ–µ–Ω–∞</span>{% endif %}
              </div>
            </div>
          </div>
          <div class="mt-3 metrics-grid">
            <div><span>Accuracy</span><b>{{ '%.2f'|format(log.accuracy or 0) }}</b></div>
            <div><span>Time</span><b>{{ '%.2f'|format(log.time_score or 0) }}</b></div>
            <div><span>Progress</span><b>{{ '%.2f'|format(log.progress_score or 0) }}</b></div>
            <div><span>Motivation</span><b>{{ '%.2f'|format(log.motivation_score or 0) }}</b></div>
            <div><span>Total</span><b>{{ '%.2f'|format(log.total_score or 0) }}</b></div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</div>
<style>
.timeline{position:relative;margin:20px 0}
.timeline:before{content:"";position:absolute;left:12px;top:0;bottom:0;width:2px;background:#e9ecef}
.timeline-item{position:relative;padding-left:40px;margin-bottom:18px}
.timeline-item:before{content:"";position:absolute;left:6px;top:6px;width:12px;height:12px;background:#007bff;border-radius:50%}
.timeline-card{background:#fff;border:1px solid #e9ecef;border-radius:8px;padding:16px;box-shadow:0 2px 10px rgba(0,0,0,.04)}
.metrics-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
.metrics-grid div{background:#f8f9fa;border-radius:6px;padding:8px 10px;display:flex;justify-content:space-between}
.metrics-grid span{color:#6c757d}
</style>
{% endblock %}


<!-- =============================================================
3) run_evaluation.html ‚Äî –ó–∞–ø—É—Å–∫ —Ä–∞—Å—á—ë—Ç–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
–û–ø–∏—Å–∞–Ω–∏–µ:
- –†–æ—É—Ç—ã: GET /admin/progress/run, POST /admin/progress/evaluate
- –ö–æ–Ω—Ç–µ–∫—Å—Ç (GET): now (–¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏), default_period_end = today, info: evaluation_period_days
- –ü–æ–≤–µ–¥–µ–Ω–∏–µ: –≤—ã–±—Ä–∞—Ç—å –∫–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ ‚Üí –±–µ–∫ –≤—ã—á–∏—Å–ª—è–µ—Ç start = end - 6 days; –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–≤—å—é –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ø—ã—Ç–æ–∫, –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ —Ç.–ø.
============================================================= -->
{% extends "admin/base_admin.html" %}
{% block title %}–ó–∞–ø—É—Å–∫ —Ä–∞—Å—á—ë—Ç–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞{% endblock %}
{% block admin_content %}
<div class="admin-content">
  <h2>üöÄ –ó–∞–ø—É—Å–∫ —Ä–∞—Å—á—ë—Ç–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</h2>
  <form action="{{ url_for('admin.evaluate_progress') }}" method="post" class="card p-3">
    <div class="row g-3">
      <div class="col-md-4">
        <label class="form-label">–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞ –ø–µ—Ä–∏–æ–¥–∞</label>
        <input type="date" name="period_end" value="{{ default_period_end }}" class="form-control" required>
        <div class="form-text">–ü–µ—Ä–∏–æ–¥ = 7 –¥–Ω–µ–π (start = end ‚àí 6)</div>
      </div>
      <div class="col-md-4">
        <label class="form-label">–¢–µ–º–∞</label>
        <select name="topic_id" class="form-select">
          <option value="">–í—Å–µ —Ç–µ–º—ã</option>
          {% for t in topics %}<option value="{{ t.id }}">{{ t.name }}</option>{% endfor %}
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">–§–∏–ª—å—Ç—Ä –ø–æ —É—Ä–æ–≤–Ω—é</label>
        <select name="level" class="form-select">
          <option value="">–õ—é–±–æ–π</option>
          <option value="low">Low</option>
          <option value="medium">Medium</option>
          <option value="high">High</option>
        </select>
      </div>
    </div>
    <div class="mt-3 d-flex gap-2">
      <button class="btn btn-primary">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
      <a href="{{ url_for('admin.progress_dashboard') }}" class="btn btn-outline-secondary">–û—Ç–º–µ–Ω–∞</a>
    </div>
  </form>

  {% if preview %}
  <div class="mt-4">
    <h5>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä: —á—Ç–æ –±—É–¥–µ—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ</h5>
    <ul>
      <li>–ü–µ—Ä–∏–æ–¥: {{ preview.period_start }} ‚Äî {{ preview.period_end }}</li>
      <li>–°—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤ –≤—ã–±–æ—Ä–∫–µ: {{ preview.students_count }}</li>
      <li>–ü–æ–ø—ã—Ç–æ–∫ –∑–∞ –ø–µ—Ä–∏–æ–¥: {{ preview.attempts_count }}</li>
    </ul>
  </div>
  {% endif %}
</div>
{% endblock %}


<!-- =============================================================
4) topic_analytics.html ‚Äî –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ —Ç–µ–º–µ (–ø—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è)
–û–ø–∏—Å–∞–Ω–∏–µ:
- –†–æ—É—Ç: GET /admin/analytics/topic/<int:topic_id>
- –ö–æ–Ω—Ç–µ–∫—Å—Ç:
  topic: {id, name}
  summary: { tasks_total, by_level: {low, medium, high}, attempts_total, accuracy_avg, time_avg }
  worst_tasks: [{id, title, accuracy}], best_tasks: [...]
- –î–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Chart.js –∏–ª–∏ –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã.
============================================================= -->
{% extends "admin/base_admin.html" %}
{% block title %}–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç–µ–º—ã{% endblock %}
{% block admin_content %}
<div class="admin-content">
  <h2>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ ‚Äî ¬´{{ topic.name }}¬ª</h2>
  <div class="stats-grid">
    <div class="stat-card"><div class="stat-number">{{ summary.tasks_total }}</div><div class="stat-label">–ó–∞–¥–∞–Ω–∏–π</div></div>
    <div class="stat-card"><div class="stat-number">{{ summary.attempts_total }}</div><div class="stat-label">–ü–æ–ø—ã—Ç–æ–∫</div></div>
    <div class="stat-card"><div class="stat-number">{{ '%.1f'|format(summary.accuracy_avg*100) }}%</div><div class="stat-label">–°—Ä–µ–¥–Ω—è—è —Ç–æ—á–Ω–æ—Å—Ç—å</div></div>
    <div class="stat-card"><div class="stat-number">{{ '%.0f'|format(summary.time_avg) }} —Å–µ–∫</div><div class="stat-label">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è</div></div>
  </div>

  <h5 class="mt-4">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º</h5>
  <div class="levels-grid">
    <div>Low <div class="progress"><div class="progress-bar bg-info" style="width: {{ summary.by_level.low / summary.tasks_total * 100 }}%"></div></div></div>
    <div>Medium <div class="progress"><div class="progress-bar bg-warning" style="width: {{ summary.by_level.medium / summary.tasks_total * 100 }}%"></div></div></div>
    <div>High <div class="progress"><div class="progress-bar bg-danger" style="width: {{ summary.by_level.high / summary.tasks_total * 100 }}%"></div></div></div>
  </div>

  <div class="row mt-4 g-3">
    <div class="col-md-6">
      <div class="card p-3">
        <h6>–õ—É—á—à–∏–µ –∑–∞–¥–∞–Ω–∏—è (—Ç–æ—á–Ω–æ—Å—Ç—å)</h6>
        <ol class="mb-0">
          {% for t in best_tasks %}
          <li><a href="{{ url_for('tasks.view_task', task_id=t.id) }}">{{ t.title }}</a> ‚Äî {{ '%.0f'|format(t.accuracy*100) }}%</li>
          {% endfor %}
        </ol>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card p-3">
        <h6>–°–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è (–Ω–∏–∑–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å)</h6>
        <ol class="mb-0">
          {% for t in worst_tasks %}
          <li><a href="{{ url_for('tasks.view_task', task_id=t.id) }}">{{ t.title }}</a> ‚Äî {{ '%.0f'|format(t.accuracy*100) }}%</li>
          {% endfor %}
        </ol>
      </div>
    </div>
  </div>
</div>
<style>
.levels-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.progress{height:10px;background:#e9ecef;border-radius:6px}
.progress-bar{height:10px;border-radius:6px}
</style>
{% endblock %}


<!-- =============================================================
5) data_imports.html ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–æ–º –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
–û–ø–∏—Å–∞–Ω–∏–µ:
- –†–æ—É—Ç: GET /admin/imports
- –ö–æ–Ω—Ç–µ–∫—Å—Ç:
  files_status: [{name, uploaded: bool, records: int, last_import_at}]
  actions: POST /admin/imports/upload (multipart), POST /admin/imports/reset
- UI: —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ (users.json, topics.json, math_tasks.json, week1/2/3, logs, progress, config) + —Å—Ç–∞—Ç—É—Å—ã.
============================================================= -->
{% extends "admin/base_admin.html" %}
{% block title %}–ò–º–ø–æ—Ä—Ç –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö{% endblock %}
{% block admin_content %}
<div class="admin-content">
  <h2>üì• –ò–º–ø–æ—Ä—Ç –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö</h2>
  <div class="table-container">
    <table class="data-table">
      <thead><tr><th>–§–∞–π–ª</th><th>–°—Ç–∞—Ç—É—Å</th><th>–ó–∞–ø–∏—Å–µ–π</th><th>–ü–æ—Å–ª–µ–¥–Ω–∏–π –∏–º–ø–æ—Ä—Ç</th><th>–î–µ–π—Å—Ç–≤–∏–µ</th></tr></thead>
      <tbody>
        {% for f in files_status %}
        <tr>
          <td>{{ f.name }}</td>
          <td>{% if f.uploaded %}<span class="badge bg-success">–ó–∞–≥—Ä—É–∂–µ–Ω</span>{% else %}<span class="badge bg-secondary">–ù–µ—Ç</span>{% endif %}</td>
          <td>{{ f.records or 0 }}</td>
          <td>{{ f.last_import_at or '‚Äî' }}</td>
          <td>
            <form action="{{ url_for('admin.upload_demo_file') }}" method="post" enctype="multipart/form-data" class="d-flex gap-2">
              <input type="hidden" name="file_name" value="{{ f.name }}">
              <input type="file" name="file" accept=".json" class="form-control form-control-sm" required>
              <button class="btn btn-sm btn-primary">–ò–º–ø–æ—Ä—Ç</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <form action="{{ url_for('admin.reset_demo') }}" method="post" class="mt-3" onsubmit="return confirm('–û—á–∏—Å—Ç–∏—Ç—å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ?');">
    <button class="btn btn-outline-danger">‚ôª –û—á–∏—Å—Ç–∏—Ç—å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ</button>
  </form>
</div>
{% endblock %}

–î–æ–±–∞–≤–∏–ª –º–∞–∫–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ ¬´–î–µ—Ç–∞–ª–∏ –Ω–µ–¥–µ–ª–∏¬ª –≤ Canvas:

---

**week_details_modal.html**

```html
<div class="modal" id="weekDetailsModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">–î–µ—Ç–∞–ª–∏ –Ω–µ–¥–µ–ª–∏: {{ week_label }}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <table class="table table-sm table-striped">
          <thead>
            <tr>
              <th>–î–∞—Ç–∞</th>
              <th>–ó–∞–¥–∞—á–∞</th>
              <th>–ü–æ–ø—ã—Ç–∫–∞</th>
              <th>–í—Ä–µ–º—è (—Å–µ–∫)</th>
              <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
              <th>–ë–∞–ª–ª—ã</th>
            </tr>
          </thead>
          <tbody>
            {% for attempt in task_attempts %}
              <tr>
                <td>{{ attempt.created_at.strftime('%d.%m.%Y') }}</td>
                <td>{{ attempt.task.title }}</td>
                <td>{{ attempt.attempt_number }}</td>
                <td>{{ attempt.time_spent }}</td>
                <td>{% if attempt.is_correct %}‚úî{% else %}‚úò{% endif %}</td>
                <td>{{ attempt.partial_score }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>
</div>
```

---

**–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:**
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç**: `week_label` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–ù–µ–¥–µ–ª—è 1¬ª), `task_attempts` ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ–ø—ã—Ç–æ–∫ (TaskAttempt) –∑–∞ –Ω–µ–¥–µ–ª—é.
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –≤—Å–µ–º –ø–æ–ø—ã—Ç–∫–∞–º —É—á–µ–Ω–∏–∫–∞ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é.
- **–í—ã–∑–æ–≤**: –º–æ–¥–∞–ª–∫–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ –∫–Ω–æ–ø–∫–µ ¬´–î–µ—Ç–∞–ª–∏¬ª –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞—Å—á—ë—Ç–∞.
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: Bootstrap 4/5 (–º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ, —Ç–∞–±–ª–∏—Ü—ã).
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞ –ø–æ —Ñ–∏–ª—å—Ç—Ä—É user_id + date range.

---

<!-- =============================================================
6) _week_details_modal.html ‚Äî –ú–æ–¥–∞–ª–∫–∞ ¬´–î–µ—Ç–∞–ª–∏ –Ω–µ–¥–µ–ª–∏¬ª (–ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π partial)
–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –±—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ø—ã—Ç–æ–∫ (TaskAttempt) –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –Ω–µ–¥–µ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –¥–ª—è –ø–∞—Ä—ã (user_id, topic_id) –∏ —É—Ä–æ–≤–Ω—è.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –ø–æ–¥–∫–ª—é—á–∞—Ç—å –∫–∞–∫ include –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –∏—Å—Ç–æ—Ä–∏–∏/–¥–∞—à–±–æ—Ä–¥–∞ –∏ –≤—ã–∑—ã–≤–∞—Ç—å —á–µ—Ä–µ–∑ data-–∞—Ç—Ä–∏–±—É—Ç—ã.
- –†–æ—É—Ç –¥–∞–Ω–Ω—ã—Ö (–≤–∞—Ä–∏–∞–Ω—Ç—ã):
  a) –°–µ—Ä–≤–µ—Ä –æ—Ç–¥–∞—ë—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É —É–∂–µ —Å –¥–∞–Ω–Ω—ã–º–∏ (–∫–æ–Ω—Ç–µ–∫—Å—Ç attempts).
  b) –õ–µ–Ω–∏–≤–∞—è –ø–æ–¥–≥—Ä—É–∑–∫–∞ –ø–æ AJAX: GET /admin/progress/week_details?user_id=&topic_id=&period_start=&period_end=
- –ö–æ–Ω—Ç–µ–∫—Å—Ç (–≤–∞—Ä–∏–∞–Ω—Ç –ê):
  attempts: [
    { task_id, task_title, level, attempt_number, is_correct, partial_score, time_spent, created_at }
  ]
  meta: { user, topic, period_start, period_end }
============================================================= -->
<div class="modal fade" id="weekDetailsModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">–î–µ—Ç–∞–ª–∏ –Ω–µ–¥–µ–ª–∏ ‚Äî {{ meta.user.last_name }} {{ meta.user.first_name }} / ¬´{{ meta.topic.name }}¬ª</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <div class="text-muted">–ü–µ—Ä–∏–æ–¥: {{ meta.period_start }} ‚Äî {{ meta.period_end }}</div>
          <div>
            <span class="badge bg-light text-dark">–í—Å–µ–≥–æ –ø–æ–ø—ã—Ç–æ–∫: {{ attempts|length }}</span>
          </div>
        </div>

        <div class="table-responsive">
          <table class="table table-sm align-middle">
            <thead class="table-light">
              <tr>
                <th>–î–∞—Ç–∞/–≤—Ä–µ–º—è</th>
                <th>–ó–∞–¥–∞–Ω–∏–µ</th>
                <th>–£—Ä–æ–≤–µ–Ω—å</th>
                <th class="text-center">‚Ññ –ø–æ–ø—ã—Ç–∫–∏</th>
                <th class="text-center">–í–µ—Ä–Ω–æ</th>
                <th class="text-center">partial_score</th>
                <th class="text-end">–í—Ä–µ–º—è, —Å–µ–∫</th>
              </tr>
            </thead>
            <tbody>
              {% for a in attempts %}
              <tr>
                <td style="white-space:nowrap;">{{ a.created_at.strftime('%d.%m.%Y %H:%M') if a.created_at.__class__.__name__ == 'datetime' else a.created_at }}</td>
                <td>
                  <a href="{{ url_for('tasks.view_task', task_id=a.task_id) }}" target="_blank">#{{ a.task_id }}</a>
                  <div class="small text-muted">{{ a.task_title or '' }}</div>
                </td>
                <td><span class="badge level-{{ a.level }}">{{ a.level|capitalize }}</span></td>
                <td class="text-center">{{ a.attempt_number }}</td>
                <td class="text-center">{% if a.is_correct %}‚úÖ{% else %}‚Äî{% endif %}</td>
                <td class="text-center">{{ '%.2f'|format(a.partial_score or 0) }}</td>
                <td class="text-end">{{ a.time_spent }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="row g-3 mt-2">
          <div class="col-md-3">
            <div class="p-2 border rounded bg-light">–î–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: <b>{{ summary.active_days }}</b></div>
          </div>
          <div class="col-md-3">
            <div class="p-2 border rounded bg-light">–í—ã—Ö–æ–¥–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: <b>{{ summary.weekend_days }}</b></div>
          </div>
          <div class="col-md-3">
            <div class="p-2 border rounded bg-light">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è: <b>{{ '%.0f'|format(summary.avg_time or 0) }} —Å–µ–∫</b></div>
          </div>
          <div class="col-md-3">
            <div class="p-2 border rounded bg-light">–°—É–º–º–∞ partial_score: <b>{{ '%.2f'|format(summary.partial_sum or 0) }}</b></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-secondary" href="{{ url_for('admin.export_week_csv', user_id=meta.user.id, topic_id=meta.topic.id, period_start=meta.period_start, period_end=meta.period_end) }}">üì§ –≠–∫—Å–ø–æ—Ä—Ç CSV</a>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>
</div>

<script>
// –í–∞—Ä–∏–∞–Ω—Ç –í: –õ–µ–Ω–∏–≤–∞—è –ø–æ–¥–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –º–æ–¥–∞–ª–∫–∏ –ø–æ AJAX (–µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –≥–æ—Ç–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
// –ü—Ä–∏–º–µ—Ä: –∫–Ω–æ–ø–∫–∞ –≤—ã–∑—ã–≤–∞–µ—Ç openWeekDetails(userId, topicId, start, end)
async function openWeekDetails(userId, topicId, start, end){
  try{
    const url = `/admin/progress/week_details?user_id=${userId}&topic_id=${topicId}&period_start=${start}&period_end=${end}`;
    const res = await fetch(url, {headers:{'X-Requested-With':'XMLHttpRequest'}});
    const html = await res.text();
    const container = document.createElement('div');
    container.innerHTML = html; // –æ–∂–∏–¥–∞–Ω–∏–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—ë—Ç —É–∂–µ –≥–æ—Ç–æ–≤—É—é —Ä–∞–∑–º–µ—Ç–∫—É <div class="modal ...">
    document.body.appendChild(container.firstElementChild);
    const modalEl = document.getElementById('weekDetailsModal');
    const bsModal = new bootstrap.Modal(modalEl);
    bsModal.show();
    modalEl.addEventListener('hidden.bs.modal',()=>modalEl.remove());
  }catch(e){ console.error(e); alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –Ω–µ–¥–µ–ª–∏'); }
}
</script>

<style>
.badge.level-low{background:#d1ecf1;color:#0c5460}
.badge.level-medium{background:#fff3cd;color:#856404}
.badge.level-high{background:#f8d7da;color:#721c24}
.badge.level-done{background:#d4edda;color:#155724}
</style>


<!-- =============================================================
–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: –∫–Ω–æ–ø–∫–∞ –≤—ã–∑–æ–≤–∞ –º–æ–¥–∞–ª–∫–∏ –∏–∑ history_timeline.html
–î–æ–±–∞–≤—å—Ç–µ –∫ –∫–∞—Ä—Ç–æ—á–∫–µ –Ω–µ–¥–µ–ª–∏ –∫–Ω–æ–ø–∫—É, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª–∫—É —Å –Ω—É–∂–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.
============================================================= -->
<!-- –ü—Ä–∏–º–µ—Ä –∫–Ω–æ–ø–∫–∏ –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞ –ø–æ logs –≤ history_timeline.html -->
<button class="btn btn-sm btn-outline-primary" onclick="openWeekDetails({{ user.id }}, {{ topic.id }}, '{{ log.period_start }}', '{{ log.period_end }}')">–î–µ—Ç–∞–ª–∏ –Ω–µ–¥–µ–ª–∏</button>

